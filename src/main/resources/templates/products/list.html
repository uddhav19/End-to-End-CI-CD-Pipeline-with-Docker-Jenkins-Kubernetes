<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - ShopZone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/nav :: navbar}"></div>
<div th:replace="~{fragments/nav :: alerts}"></div>

<div class="container py-4">
    <div class="row">
        <!-- Sidebar Filters -->
        <div class="col-lg-3 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-dark text-white fw-bold">
                    <i class="bi bi-funnel me-2"></i>Filter Products
                </div>
                <div class="card-body">
                    <h6 class="fw-semibold mb-3">Categories</h6>
                    <div class="d-flex flex-column gap-2">
                        <a th:href="@{/products}" class="btn btn-sm btn-outline-secondary text-start"
                           th:classappend="${selectedCategory == null and search == null} ? 'active' : ''">
                            <i class="bi bi-grid me-1"></i>All Products
                        </a>
                        <a th:each="cat : ${categories}"
                           th:href="@{/products(category=${cat})}"
                           th:text="${cat}"
                           class="btn btn-sm btn-outline-secondary text-start"
                           th:classappend="${selectedCategory == cat} ? 'active' : ''">Category</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Grid -->
        <div class="col-lg-9">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="fw-bold mb-0"
                        th:text="${search != null ? 'Results for: &quot;' + search + '&quot;' :
                                   selectedCategory != null ? selectedCategory :
                                   'All Products'}">Products</h4>
                    <small class="text-muted" th:text="${products.size()} + ' products found'"></small>
                </div>
            </div>

            <!-- Search bar -->
            <form th:action="@{/products}" method="get" class="mb-4">
                <div class="input-group">
                    <input class="form-control" type="search" name="search"
                           th:value="${search}" placeholder="Search in products...">
                    <button class="btn btn-warning" type="submit"><i class="bi bi-search"></i> Search</button>
                </div>
            </form>

            <!-- Empty state -->
            <div th:if="${products.empty}" class="text-center py-5">
                <i class="bi bi-search display-1 text-muted"></i>
                <h5 class="mt-3 text-muted">No products found</h5>
                <a th:href="@{/products}" class="btn btn-primary mt-2">View All Products</a>
            </div>

            <!-- Product Grid -->
            <div class="row g-4" th:if="${!products.empty}">
                <div class="col-sm-6 col-xl-4" th:each="product : ${products}">
                    <div class="card product-card h-100 border-0 shadow-sm">
                        <div class="product-img-wrapper">
                            <img th:src="${product.imageUrl ?: 'https://via.placeholder.com/300?text=Product'}"
                                 class="card-img-top product-img" th:alt="${product.name}">
                            <div class="product-overlay">
                                <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-light btn-sm">Quick View</a>
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <span class="badge bg-secondary mb-1 align-self-start small" th:text="${product.category}"></span>
                            <h6 class="card-title fw-semibold" th:text="${product.name}">Name</h6>
                            <p class="text-muted small" th:text="${#strings.abbreviate(product.description ?: '', 80)}">Desc</p>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="fw-bold text-primary fs-5" th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 2)}">$0</span>
                                    <small class="text-muted" th:if="${product.stockQuantity > 0}"
                                           th:text="${product.stockQuantity} + ' in stock'"></small>
                                    <small class="text-danger" th:if="${product.stockQuantity == 0}">Out of stock</small>
                                </div>
                                <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-dark w-100 btn-sm mt-2">
                                    <i class="bi bi-eye me-1"></i>View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/nav :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
